#!/bin/bash -e

#
# If the "/etc/config/shipper-backend" assemble script is executed with the "-h" flag, print one usage.
#
if [[ "$1" == "-h" ]]; then
  exec /usr/libexec/s2i/usage
fi

# ALTERAÇÃO (exigência da questão):
# Definição da variável de ambiente SERVER_PORT via script S2I

#export SERVER_PORT=8081

echo "Before assembling"
env

pushd /tmp/src

make node=cloud build
rc=$?

make dest=/opt/app-root install

if [ $rc -eq 0 ]; then
  echo "After successful assembling"
else
  echo "After failed assembling"
fi

popd

exit $rc
